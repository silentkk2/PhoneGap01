<!DOCTYPE html>
<!--
Copyright (c) 2012-2014 Aminur Rahman-->
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <script type="text/javascript" src="cordova.js"></script>

        <!--<link rel="stylesheet" type="text/css" href="css/index.css" />-->
        <!--<script type="text/javascript" src="js/index.js"></script>-->
        <!--<script type="text/javascript" src="js/flashlight.js"></script>-->
        <!--<script type="text/javascript" src="js/jquery-transform.js"></script>-->
        
        <!--<link rel="stylesheet" href="css/jquery.mobile-1.3.1.css" />-->
        <!--<script src="js/jquery-1.9.1.min.js"></script>-->
        <!--<script src="js/jquery.mobile-1.3.1.min.js"></script>-->
        
        <script type="text/javascript" src="http://www.google.com/jsapi"></script>
        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
                
        <link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css" />
        <script src="js/jquery-1.11.1.min.js"></script>
        <script src="js/jquery.mobile-1.4.5.min.js"></script>
        
        <link rel="stylesheet" type="text/css" href="css/luck.css">
        
        
        
        <!--<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />-->
        <!--<script src="js/jquery-ui-datepicker.js"></script>-->
    <!--<link rel="stylesheet" type="text/css" href="css/jquery-ui.datepicker.css" />-->
    <!--<link rel="stylesheet" type="text/css" href="css/jquery-ui.structure.css" />-->
    <!--<link rel="stylesheet" type="text/css" href="css/jquery-ui.theme.css" />-->
        
        
        <style type="text/css">
            .calendar {
                width:100% !important;
            }
            
            #map{ 
                width: 500px;
                height: 500px;
                position: absolute;
                top: 50%;
                left: 50%;
                margin-top: -250px;
                margin-left: -250px;
            }

            #mapContent{
                width: 300px;
                height: 300px;
                background: #eee;
                position: relative;
                overflow: hidden;
                float: left;
            }

        </style>
        <title>Hello World</title>
    </head>
    <body>

        <div data-role="page" id="index" >
            <div data-role="header" data-position="fixed">
                <h1>Tito Was Here</h1>
            </div>
            <div data-role="content">
                Welcome
                <a href="#" onclick="getXml()">Get NOAA XML</a>
                <a href="#" onclick="getNumberOfDays()">Number Of Days</a>
                <a href="#" onclick="getAllTables()">All Tables</a>
                <br>
                <a href="#googlePage" data-transition="slide"> Google </a>
                <a href="#dayPage" data-transition="slide"> Day </a>
            </div>
        </div>

        

        <div data-role="page" id="resultPage" data-theme="b">
            <div data-role="header"  id="resultPageHeader" data-position="fixed">
                <a href="#index" data-transition="slide" data-direction="reverse" data-icon="home"> Home </a>
                <h1>Header</h1>
            </div>
            <div data-role="content"  id="resultPageContent">
                <div id="resultPageOutput">

                </div>
            </div>
            <div data-role="footer" id ="resultPageFooter" data-position="fixed">
                <h4>Footer</h4>
            </div>
        </div>

        <div data-role="page" id="googlePage">
            <div data-role="header"  id="googlePageHeader" data-position="fixed">
                <a href="#index" data-transition="slide" data-direction="reverse" data-icon="home"> Home </a>
                <h1>Google Page</h1>
            </div>
            <div data-role="content"  id="googlePageContent">
                <form method="POST" onsubmit="return getMagnaticNorth()" data-ajax="false">
                    <label for="street">Street:</label>
                    <input type="text" name="street" id="street" data-clear-btn="true">  
                    <label for="city">City</label>
                    <input type="text" name="city" id="city" data-clear-btn="true">  
                    <label for="state">State:</label>
                    <input type="text" name="state" id="state" data-clear-btn="true">  
                    <label for="zip">Zip:</label>
                    <input type="text" name="zip" id="zip" data-clear-btn="true">  
                    <input type="submit" data-inline="true" value="Submit">
                </form>
                <hr/>
                <div id="googlePageOutput">
                </div>
            </div>
            <div data-role="footer" id ="googlePageFooter" data-position="fixed">
                <h4><a href="#" data-transition="slide" onclick="goToMapPage();"> Map </a></h4>
            </div>
        </div>

        <div data-role="page" id="mappage">
            <div data-role="header" id="mapHeader" data-position="fixed">
                <a href="#googlePage" data-transition="slide" data-direction="reverse" data-icon="home"> Google </a>
                <h1>Map Header</h1>
            </div>
            <div data-role="content" id="mapPageContent">
                <div  style="padding:0;" id="mapContent">
                    <div id="map" ></div>
                </div>
                <div id="mapPageOutput">
                </div>
            </div>
            <div data-role="footer" id ="mapFooter" data-position="fixed">
                <button type="button" onclick="rotateMapLeft10()" value="10 Left"></button>
                <button type="button" onclick="rotateMapLeft5()" value="5 Left"></button>
                <button type="button" onclick="lockMap()" value="Lock"></button>
                <button type="button" onclick="rotateMapRight5()" value="5 Right"></button>
                <button type="button" onclick="rotateMapRight10()" value="10 Right"></button>
            </div>
        </div>

        <div data-role="page" id="registerPage" >
            <div data-role="header" data-position="fixed">
            </div>
            <div data-role="content">
                <center>
                    <form method="POST" onsubmit="return register()" data-ajax="false">
                        <center>
                            <img src="img/LucyGrl_V2_R1.png" alt="whattheluck" class="appimage"/>
                            <h1>What the Luck?</h1>
                            <h4>Enter your date of birth<br />to know the stength of <br />your luck FOREVER!</h4>
                            <input type="date" name="bday" id="bday" required>
                        </center>
                        <br/>
                        <input type="submit" data-inline="true" value="Continue">
                    </form>
                </center>
            </div>
        </div>
        
        
        
        <div data-role="page" id="dayPage" >
            <div data-role="content"  id="dayPageContent">
                <center>
                    <img src="img/LucyGrl_V2_R2.png" alt='appimagesub' class="appimagesub"/>
                    <div id="dayPageUserOutput">
                    </div>
                    <div id="timeofday">
                        <h3> LUCK of this HOUR is</h3>
                        <div id="timeOutput">
                        </div>
                        <select id="timePicker" name="timePicker" size="1">
                            <option value="000">12:00 AM</option>
                            <option value="100">1:00 AM</option>
                            <option value="200">2:00 AM</option>
                            <option value="300">3:00 AM</option>
                            <option value="400">4:00 AM</option>
                            <option value="500">5:00 AM</option>
                            <option value="600">6:00 AM</option>
                            <option value="700">7:00 AM</option>
                            <option value="800">8:00 AM</option>
                            <option value="900">9:00 AM</option>
                            <option value="1000">10:00 AM</option>
                            <option value="1100">11:00 AM</option>
                            <option value="1200">12:00 PM</option>
                            <option value="1300">1:00 PM</option>
                            <option value="1400">2:00 PM</option>
                            <option value="1500">3:00 PM</option>
                            <option value="1600">4:00 PM</option>
                            <option value="1700">5:00 PM</option>
                            <option value="1800">6:00 PM</option>
                            <option value="1900">7:00 PM</option>
                            <option value="2000">8:00 PM</option>
                            <option value="2100">9:00 PM</option>
                            <option value="2200">10:00 PM</option>
                            <option value="2300">11:00 PM</option>
                        </select>
                    </div>
                     <h3>LUCK of this DAY is</h3>
                    <div id="dayPageOutput"></div>
                    <input type="date" name="dayPagePicker" id="dayPagePicker">
                </center>
            </div>
            <div data-role="footer" id ="dayPageFooter" data-position="fixed">
                <center>
                    <a href="#" data-role="button" onclick="newUser();" data-inline="true">Back</a>
                    <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                    <a href="#" data-role="button" onclick="resetDateAndTime();" data-inline="true">Reset</a>
                </center>
            </div>
        </div>

        <script type="text/javascript">

            var map;
            var lat;
            var long;
            var mapOrientation = 0;
            var magneticDeclination;
            var lightstate = false;
            var userName;
            var userDOB;
            var userSign;
            var userSignId;
            var userSignGroupId;

            var signid;

            var date01 = "1900-01-01";
            
//            $("#datepicker").datepicker({
//                onSelect: function(dateText, inst) { 
//                   setDate($(this).datepicker( 'getDate' ));
//                   calculateDay();
//                }
//             });
            
            $("#dayPagePicker").change(function(event){
                if($('#dayPagePicker').val() == ""){
                    setDate(new Date());
                }
//                updateCalendar();
                calculateDay();
            });
            
            $("#timePicker").change(function(event){
              calculateTime();
            });
            

            function getNumberOfDays() {
                alert(daydiff(parseDate($('#bday').val()), parseDate(date01)));

            }

            function parseDate(str) {
                var mdy = str.split('-');
                ////alert(mdy[0] +  mdy[1]-1 +  mdy[2]);
                return new Date(mdy[0], mdy[1] - 1, mdy[2]);
            }

            function daydiff(first, second) {
                return Math.ceil(Math.abs((second.getTime() - first.getTime())) / (1000 * 60 * 60 * 24));
            }



            function goToMapPage() {
                initializeMap(lat, long);

                $.mobile.changePage("#mappage", {reverse: false, transition: "slide"});

            }

            function lockMap() {
                map.setOptions({draggable: false, zoomControl: false, scrollwheel: false, disableDoubleClickZoom: true});
            }

            function initializeMap(lat, long) {
                var latlong = new google.maps.LatLng(lat, long);

                var mapOptions = {
                    zoom: 20,
                    center: latlong,
                    mapTypeId: google.maps.MapTypeId.HYBRID
                };

                map = new google.maps.Map(document.getElementById("map"), mapOptions);

            }


            var geocoder = new google.maps.Geocoder();

            function getLatLong(address) {
                geocoder.geocode({'address': address}, function(results, status) {
                    if (status == google.maps.GeocoderStatus.OK) {
//						//alert("before");
                        lat = results[0].geometry.location.lat();
                        long = results[0].geometry.location.lng();
//						alert ("lat: " + lat + " Long: " + long);
                        goToMapPage();
                        getMagXml(lat, long);
                    } else {
                        //alert('Geocode was not successful for the following reason: ' + status);
                    }
                });
            }

            function getMagXml(lat, long) {
                $.ajax({
                    type: 'GET',
                    url: "http://www.ngdc.noaa.gov/geomag-web/calculators/calculateDeclination",
                    data: {
                        lat1: lat,
                        lon1: long,
                        resultFormat: "xml"
                    },
                    dataType: "xml",
                    success: function(xml) {
                        magneticDeclination = $(xml).find('declination').first().text();

//						//alert("Magnetic "  + Magnetic);
                        $('#mapPageOutput').html("Lat: " + lat + "<br>" +
                                "Long: " + long + "<br>" +
                                "Magnetic North: " + magneticDeclination + "<br>");
                    }
                });
            }

            function getMagnaticNorth() {
                var street = $('[name="street"]').val();
                var city = $('[name="city"]').val();
                var state = $('[name="state"]').val();
                var zip = $('[name="zip"]').val();
                var address = street + city + state + zip;

                getLatLong(address);

                return false;
            }

            function rotateMapRight5() {
                mapOrientation += 5;
                $('#map').animate({
                    rotate: mapOrientation
                }, 0);
                window.plugins.toast.show('Current Map Orientation: ' + mapOrientation, 'short', 'center', false);
            }

            function rotateMapRight10() {
                mapOrientation += 10;
                $('#map').animate({
                    rotate: mapOrientation
                }, 0);
                window.plugins.toast.show('Current Map Orientation: ' + mapOrientation, 'short', 'center', false);
            }

            function rotateMapLeft5() {
                mapOrientation -= 5;
                $('#map').animate({
                    rotate: mapOrientation
                }, 0);
                window.plugins.toast.show('Current Map Orientation: ' + mapOrientation, 'short', 'center', false);
            }

            function rotateMapLeft10() {
                mapOrientation -= 10;
                $('#map').animate({
                    rotate: mapOrientation
                }, 0);
                window.plugins.toast.show('Current Map Orientation: ' + mapOrientation, 'short', 'center', false);
            }

            function getXml() {
                $.ajax({
                    type: 'GET',
                    url: "http://www.ngdc.noaa.gov/geomag-web/calculators/calculateDeclination",
                    data: {
                        lat1: "34.055223",
                        lon1: "-118.413264",
                        resultFormat: "xml"
                    },
                    dataType: "xml",
                    success: function(xml) {
                        var magnatic = $(xml).find('declination').first().text();
                        //alert(magnatic);
                    }
                });
            }

            var database;
            document.addEventListener("deviceready", onDeviceReady, false);

            function onDeviceReady() {
                document.addEventListener("backbutton", onBackKeyDown, false);
                database = window.openDatabase("Database", "1.0", "PhoneGap01 DB", 10 * 1024 * 1024);
                database.transaction(createDB, errorCB, successCB);
                database.transaction(loadUserProfile, errorCB);
            }
            
            function onBackKeyDown(){
                window.plugins.toast.show('back button', 'short', 'center', false);
            }

            function createDB(tx) {
                tx.executeSql("SELECT name FROM sqlite_master WHERE type='table' and name='USERS'", [], usersExists, errorCB);
                tx.executeSql("SELECT name FROM sqlite_master WHERE type='table' and name='SIGNS'", [], signsExists, errorCB);
                tx.executeSql("SELECT name FROM sqlite_master WHERE type='table' and name='DOBTOSIGN'", [], dobtosignExists, errorCB);
                tx.executeSql("SELECT name FROM sqlite_master WHERE type='table' and name='DAY'", [], dayExists, errorCB);
                tx.executeSql("SELECT name FROM sqlite_master WHERE type='table' and name='SIGNTIME'", [], signtimeExists, errorCB);
            }

            function usersExists(tx, results) {
                if (results.rows.length > 0) {
                    //alert('Found USERS');
                }
                else {
                    //alert('USERS not found... Creating new table');
                    tx.executeSql('CREATE TABLE IF NOT EXISTS USERS (id unique, name, birthday, email, gender, signid)');
                }

            }


            function signsExists(tx, results) {
                if (results.rows.length > 0) {
                    //alert('Found SIGNS');
                }
                else {
                    //alert('SIGNS not found... Creating new table');
                    tx.executeSql('CREATE TABLE IF NOT EXISTS SIGNS (signid, signgroupid, sign)');

                    tx.executeSql("INSERT INTO SIGNS (signid, signgroupid, sign) values (1, 2, 'Rooster')");
                    tx.executeSql("INSERT INTO SIGNS (signid, signgroupid, sign) values (2, 3, 'Dog')");
                    tx.executeSql("INSERT INTO SIGNS (signid, signgroupid, sign) values (3, 4, 'Pig')");
                    tx.executeSql("INSERT INTO SIGNS (signid, signgroupid, sign) values (4, 1, 'Rat')");
                    tx.executeSql("INSERT INTO SIGNS (signid, signgroupid, sign) values (5, 2, 'Ox')");
                    tx.executeSql("INSERT INTO SIGNS (signid, signgroupid, sign) values (6, 3, 'Tiger')");
                    tx.executeSql("INSERT INTO SIGNS (signid, signgroupid, sign) values (7, 4, 'Rabbit')");
                    tx.executeSql("INSERT INTO SIGNS (signid, signgroupid, sign) values (8, 1, 'Dragon')");
                    tx.executeSql("INSERT INTO SIGNS (signid, signgroupid, sign) values (9, 2, 'Snake')");
                    tx.executeSql("INSERT INTO SIGNS (signid, signgroupid, sign) values (10, 3, 'Horse')");
                    tx.executeSql("INSERT INTO SIGNS (signid, signgroupid, sign) values (11, 4, 'Goat')");
                    tx.executeSql("INSERT INTO SIGNS (signid, signgroupid, sign) values (12, 1, 'Monkey')");
                }

            }

            function dobtosignExists(tx, results) {
                if (results.rows.length > 0) {
                    //alert('Found dobtosign');
                }
                else {
                    //alert('dobtosign not found... Creating new table');
                    tx.executeSql('CREATE TABLE IF NOT EXISTS DOBTOSIGN (datestart, dateend, signid)');

                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19210208,19220127,1)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19220128,19240204,2)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19240205,19250124,4)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19250125,19260212,5)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19260213,19270201,6)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19270202,19280122,7)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19280123,19299218,8)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19299219,19300129,9)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19300130,19310216,10)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19310217,19320205,11)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19320206,19330125,12)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19330126,19340213,1)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19340214,19350203,2)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19350204,19360123,3)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19360124,19370210,4)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19370211,19380130,5)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19380131,19390218,6)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19390219,19400207,7)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19400208,19410126,8)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19410127,19420214,9)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19420215,19430204,10)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19430205,19440124,11)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19440125,19450212,12)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19450213,19460201,1)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19460202,19470121,2)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19470122,19480209,4)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19480210,19490128,4)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19490129,19500216,5)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19500217,19510205,6)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19510206,19520126,7)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19520127,19530213,8)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19530214,19540202,9)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19540203,19550123,10)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19550124,19560211,11)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19560212,19570130,12)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19570131,19580217,1)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19580218,19590207,2)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19590208,19600127,3)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19600128,19610214,4)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19610215,19620204,5)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19620205,19630124,6)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19630125,19640212,7)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19640213,19650201,8)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19650202,19660120,9)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19660121,19670208,10)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19670209,19680129,11)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19680130,19690216,12)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19690217,19700205,1)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19700206,19710126,2)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19710127,19720214,3)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19720215,19730202,4)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19730203,19740122,5)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19740123,19750210,6)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19750211,19760130,7)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19760131,19770217,8)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19770218,19780206,9)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19780207,19790127,10)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19790128,19800215,11)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19800216,19810204,12)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19810205,19820124,1)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19820125,19830112,2)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19830113,19840201,3)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19840202,19850219,4)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19850220,19860208,5)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19860209,19870128,6)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19870129,19880216,7)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19880217,19890205,8)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19890206,19900126,9)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19900127,19910214,10)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19910215,19920203,11)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19920204,19930122,12)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19930123,19940209,1)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19940210,19950130,2)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19950131,19960218,3)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19960219,19970206,4)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19970207,19980127,5)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19980128,19990215,6)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (19990216,20000204,7)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20000205,20010123,8)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20010124,20020211,9)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20020212,20030131,10)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20030201,20040121,11)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20040122,20050208,12)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20050209,20060128,1)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20060129,20070217,2)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20070218,20080206,3)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20080207,20090125,4)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20090126,20100213,5)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20100214,20110202,6)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20110203,20120122,7)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20120123,20130209,8)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20130210,20140130,9)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20140131,20150218,10)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20150219,20160207,11)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20160208,20170127,12)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20170128,20180215,1)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20180216,20190204,2)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20190205,20200124,3)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20200125,20210211,4)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20210212,20200131,5)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20220201,20210211,6)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20210212,20220131,7)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20220201,20230121,6)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20230122,20240209,7)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20240210,20250128,8)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20250129,20260216,9)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20260217,20270205,10)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20270206,20280125,11)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20280126,20290212,12)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20290213,20300201,1)");
                    tx.executeSql("INSERT INTO DOBTOSIGN (datestart, dateend, signid) values (20300202,20310122,2)");
                }

            }

            function dayExists(tx, results) {
                if (results.rows.length > 0) {
                    //alert('Found DAY');
                }
                else {
                    //alert('DAY not found... Creating new table');
                    tx.executeSql('CREATE TABLE IF NOT EXISTS DAY (id, number, day)');

                    tx.executeSql("INSERT INTO DAY (id,number,day) VALUES (1,0,'Monday')");
                    tx.executeSql("INSERT INTO DAY (id,number,day) VALUES (1,1,'Tuesday')");
                    tx.executeSql("INSERT INTO DAY (id,number,day) VALUES (1,2,'Wednesday')");
                    tx.executeSql("INSERT INTO DAY (id,number,day) VALUES (1,3,'Thursday')");
                    tx.executeSql("INSERT INTO DAY (id,number,day) VALUES (2,0,'Tuesday')");
                    tx.executeSql("INSERT INTO DAY (id,number,day) VALUES (2,1,'Wednesday')");
                    tx.executeSql("INSERT INTO DAY (id,number,day) VALUES (2,2,'Thursday')");
                    tx.executeSql("INSERT INTO DAY (id,number,day) VALUES (2,3,'Monday')");
                    tx.executeSql("INSERT INTO DAY (id,number,day) VALUES (3,0,'Wednesday')");
                    tx.executeSql("INSERT INTO DAY (id,number,day) VALUES (3,1,'Thursday')");
                    tx.executeSql("INSERT INTO DAY (id,number,day) VALUES (3,2,'Monday')");
                    tx.executeSql("INSERT INTO DAY (id,number,day) VALUES (3,3,'Tuesday')");
                    tx.executeSql("INSERT INTO DAY (id,number,day) VALUES (4,0,'Thursday')");
                    tx.executeSql("INSERT INTO DAY (id,number,day) VALUES (4,1,'Monday')");
                    tx.executeSql("INSERT INTO DAY (id,number,day) VALUES (4,2,'Tuesday')");
                    tx.executeSql("INSERT INTO DAY (id,number,day) VALUES (4,3,'Wednesday')");
                }

            }
            
            function signtimeExists(tx, results) {
                if (results.rows.length > 0) {
                    //alert('Found Sign Time');
                }
                else {
                    //alert('DAY not found... Creating new table');
                    tx.executeSql("CREATE TABLE IF NOT EXISTS SIGNTIME (signgroupid, starttime, endtime, status);");
                    
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (3,300,500,'Wednesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (3,1100,1300,'Wednesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (3,1900,2100,'Wednesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (3,100,300,'Tuesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (3,900,1100,'Tuesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (3,1700,1900,'Tuesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (3,500,700,'Thursday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (3,1300,1500,'Thursday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (3,2100,2300,'Thursday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (3,700,900,'Monday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (3,1500,1700,'Monday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (3,2300,100,'Monday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (4,500,700,'Wednesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (4,1300,1500,'Wednesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (4,2100,2300,'Wednesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (4,300,500,'Tuesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (4,1100,1300,'Tuesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (4,1900,2100,'Tuesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (4,2300,100,'Thursday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (4,700,900,'Thursday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (4,1500,1700,'Thursday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (4,100,300,'Monday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (4,900,1100,'Monday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (4,1700,1900,'Monday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (1,2300,100,'Wednesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (1,700,900,'Wednesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (1,1500,1700,'Wednesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (1,500,700,'Tuesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (1,1300,1500,'Tuesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (1,2100,2300,'Tuesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (1,100,300,'Thursday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (1,900,1100,'Thursday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (1,1700,1900,'Thursday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (1,300,500,'Monday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (1,1100,1300,'Monday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (1,1900,2100,'Monday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (2,100,300,'Wednesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (2,900,1100,'Wednesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (2,1700,1900,'Wednesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (2,2300,100,'Tuesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (2,700,900,'Tuesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (2,1500,1700,'Tuesday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (2,300,500,'Thursday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (2,1100,1300,'Thursday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (2,1900,2100,'Thursday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (2,500,700,'Monday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (2,1300,1500,'Monday');");
                    tx.executeSql("Insert into signtime (signgroupid, starttime, endtime, status) VALUES (2,2100,2300,'Monday');");
                }

            }

            function loadUserProfile(tx) {
                //alert('Load user profile:');
                tx.executeSql("SELECT * FROM USERS", [], loadProfile, errorCB);
            }


            function loadProfile(tx, results) {
                //alert('Loading Profile');
                if (results.rows.length > 0) {
                    //User Exists $('#resultPageOutput').html(htmlString);
                    userName = results.rows.item(0).name;
                    userDOB = results.rows.item(0).birthday;
                    database.transaction(getSign, errorCB);
                }
                else {
                    //alert('No user found');
                    $.mobile.changePage("#registerPage", {reverse: true, transition: "slide"});
                }
            }

            function register() {
                database.transaction(registerUser, errorCB);
                return false;
            }

            function registerUser(tx) {
                //alert("atempting to register");
                var name = $('[name="fullname"]').val();
                var bday = $('[name="bday"]').val().replace(/-/g, '').toString();
                var email = $('[name="email"]').val();
                var gender = $("#gender :radio:checked").val();
                var sql = 'INSERT INTO USERS (name, birthday, email, gender) VALUES (?,?,?,?)';
                tx.executeSql(sql, [name, bday, email, gender], loadUserProfile, errorCB);
            }

            function getSign(tx) {
                //alert('DOB: ' + userDOB);
                var sql = "select * from signs where signid = (select signid from DOBTOSIGN where " + userDOB + " between datestart and dateend)";
                //alert("SQL: " + sql);
                tx.executeSql(sql, [], loadSign, errorCB);
            }
            
            function updateCalendar(){
                $('#datepicker').datepicker("setDate", parseDate($('#dayPagePicker').val()));
                
            }
            
            function setDate(date){
                var dd = date.getDate();
                var mm = date.getMonth()+1; //January is 0!
                var yyyy = date.getFullYear();
                if(dd<10){
                    dd='0'+dd;
                } 

                if(mm<10){
                    mm='0'+mm;
                } 
                $('#dayPagePicker').val(yyyy + "-" + mm + "-" + dd);
            }
            
            function setTime(time){
                var hour;
                var minutes;
//                if (time.getHours() < 10){
//                    hour = '0' + time.getHours();
//                }
//                else {
//                    hour = time.getHours();
//                }
//                if (time.getMinutes() < 10){
//                    minutes = '0' + time.getMinutes();
//                }
//                else {
//                    minutes = time.getMinutes();
//                }
                hour = time.getHours() + "00";
                //alert('hour: ' + hour);
                $("#timePicker option[value='"+hour+"']").attr('selected', 'selected');
                $('#timePicker').selectmenu('refresh');
                //$('#timePicker').val(hour);
                //alert('time: ' + $('#timePicker').val());
            }

            function loadSign(tx, results) {
                //alert('loadSign ');
                if (results.rows.length > 0) {
                    userSignId = results.rows.item(0).signid;
                    userSignGroupId = results.rows.item(0).signgroupid;
                    userSign = results.rows.item(0).sign;
                    var htmltxt = "<h1 id='sign'>" + userSign + "</h1>";// +
                            //"<img src='img/" + userSign + ".png' alt='" + userSign + "' style='height: 150px;'>";
//                     var htmltxt = "Welcome " + userName + "<br>" + '<hr/>'+
//                            "Your Sign is: <br>" +
//                            "<img src='img/" + userSign + ".png' alt='" + userSign + "' >" + '<hr/>';
                    //alert(htmltxt);
                    $.mobile.changePage("#dayPage", {reverse: false, transition: "slide"});
                    $('#dayPageUserOutput').html(htmltxt);
                  

                    var today = new Date();
                    setDate(today);
                    calculateDay();
                    setTime(today);
                    calculateTime();
                    
//                    //today = mm+'/'+dd+'/'+yyyy;
//                    var offset = daydiff(parseDate(date01), parseDate($('#dayPagePicker').val())) % 4;
//                    //alert('Offset: ' + offset);
//                    //alert('Sign Group: ' + userSignGroupId);
//                    var sql = "SELECT * FROM DAY WHERE number = " + offset + " AND id = " + userSignGroupId;
//                    tx.executeSql(sql, [], renderDay, errorCB);
//                    setTime(today);
//                    database.transaction(getTime, errorCB);
                }
                else {
                    //alert('No Signs found');
                }
            }

            function renderToday(tx, results) {
                //alert('render day');
                if (results.rows.length > 0) {
                    $('#todayLuck').html("Your Day Is: " + results.rows.item(0).day + "<br>" + '<hr/>');
                }
                else {
                    //alert('No results found');
                    tx.executeSql('SELECT * FROM day', [], renderDayList, errorCB);
                }
            }

            function deleteUser(tx) {
                //alert('deleting user profile');
                tx.executeSql('DELETE FROM USERS;', [], loadUserProfile, errorCB);
            }

            function queryDB(tx) {
                tx.executeSql('SELECT * FROM USERS', [], renderList, errorCB);
            }

            function renderList(tx, results) {
                var htmlString = '';
                var len = results.rows.length;

                for (var i = 0; i < len; i++) {
                    htmlString += "Full Name: " + results.rows.item(i).name + "<br>" +
                            "Gender: " + results.rows.item(i).gender + "<br>" +
                            "Date of Birth: " + results.rows.item(i).birthday + "<br>" +
                            "Email: " + results.rows.item(i).email + '<hr/>';
                }
                $.mobile.changePage("#resultPage", {reverse: false, transition: "slide"});
                $('#resultPageOutput').html(htmlString);
            }

            function renderDayList(tx, results) {
                var htmlString = '';
                var len = results.rows.length;

                for (var i = 0; i < len; i++) {
                    htmlString += "ID: " + results.rows.item(i).id + "<br>" +
                            "number: " + results.rows.item(i).number + "<br>" +
                            "Day: " + results.rows.item(i).day + "<br>" + '<hr/>';
                }
                $.mobile.changePage("#resultPage", {reverse: false, transition: "slide"});
                $('#resultPageOutput').html(htmlString);
            }

            function getDay(tx) {
//				var number = $('#number').val();
                var offset = daydiff(parseDate(date01), parseDate($('#dayPagePicker').val())) % 4;
//				//alert('number: ' + number);
                //alert('Offset: ' + offset);
                var sql = "SELECT * FROM DAY WHERE number = " + offset + " AND id = " + userSignGroupId;
                //alert("SQL: " + sql);
                tx.executeSql(sql, [], renderDay, errorCB);
            }

            function getTime(tx) {
                var time = $("#timePicker").val();
                if(time == '2300' || time == '000'){
                    var sql = "select * from signtime where signgroupid = " + userSignGroupId + " and starttime = 2300;" ;
                    //alert("SQL: " + sql);
                    tx.executeSql(sql, [], renderTime, errorCB);
                }
                else{
                    var sql = "select * from signtime where signgroupid = " + userSignGroupId + " and starttime <= " + time + " and endtime > " + time + ";" ;
                    //alert("SQL: " + sql);
                    tx.executeSql(sql, [], renderTime, errorCB);
                }
            }

            function renderDay(tx, results) {
                //alert('render day');
                if (results.rows.length > 0) {
                    $('#dayPageOutput').html("<h3 id='dayresult'>" + results.rows.item(0).day + "</h3>");
                }
                else {
                    //alert('No results found');
                    tx.executeSql('SELECT * FROM day', [], renderDayList, errorCB);
                }
            }

            function renderTime(tx, results) {
                //alert('render day');
                if (results.rows.length > 0) {
                    $('#timeOutput').html("<h3 id='timeresult'>" + results.rows.item(0).status + "</h3>" + '');
                }
                else {
                    //alert('No results found');
                    tx.executeSql('SELECT * FROM signtime', [], renderDayList, errorCB);
                }
            }

            function getTables(tx) {
                tx.executeSql("SELECT name FROM sqlite_master WHERE type='table'", [], renderTables, errorCB);
            }

            function renderTables(tx, results) {
                var htmlString = '';
                var len = results.rows.length;

                for (var i = 0; i < len; i++) {
                    htmlString += "Name: " + results.rows.item(i).name + "<br>" + '<hr/>';
                }
                $.mobile.changePage("#resultPage", {reverse: false, transition: "slide"});
                $('#resultPageOutput').html(htmlString);
            }

            function errorCB(error) {
                alert('Error: ' + error.message + ' code: ' + error.code);
            }

            function successCB() {
                console.log("Database Successfully Created");
            }

            function determineSign() {
                database.transaction(getSign, errorCB);
            }

            function calculateDay() {
                database.transaction(getDay, errorCB);
            }

            function calculateTime() {
                database.transaction(getTime, errorCB);
            }
            
            function resetDateAndTime(){
                var today = new Date();
                setDate(today);
                calculateDay();
                setTime(today);
                calculateTime();
            }

            function newUser() {
                database.transaction(deleteUser, errorCB);
            }


            function getAllTables() {
                database.transaction(getTables, errorCB);
                return false;
            }


            function submitToLocal() {
                var name = $('[name="fullname"]').val();
                var bday = $('[name="bday"]').val();
                var email = $('[name="email"]').val();
                var gender = $("#gender :radio:checked").val();

                window.localStorage.setItem("fullname", name);
                window.localStorage.setItem("birthday", bday);
                window.localStorage.setItem("email", email);
                window.localStorage.setItem("gender", gender);
                $.mobile.changePage("#page2", {reverse: false, transition: "slide"});
                $('#resultPageOutput').html("Full Name: " + window.localStorage.getItem("fullname") + "<br>" +
                        "Gender: " + window.localStorage.getItem("gender") + "<br>" +
                        "Date of Birth: " + window.localStorage.getItem("birthday") + "<br>" +
                        "Email: " + window.localStorage.getItem("email"));

                return false;
            }

        </script>
    </body>
</html>
